#!/bin/sh

[ "${ACTION}" = "released" ] || exit 0

# Double-click Shutdown
# Works standalone or with display-manager

# Hardcoded values
lockfile="/tmp/toff.lock"
delay=1

shutdown() {
    logger -t poweroff "Powering off..."
    
    sync
    /sbin/poweroff
}

touch_lock() {
    touch "$lockfile"
    sleep $delay
    rm -f "$lockfile"
}

if [ -e "$lockfile" ]; then
    rm -f "$lockfile"
    sleep $delay
    shutdown
else
    touch_lock &
fi

exit 0
