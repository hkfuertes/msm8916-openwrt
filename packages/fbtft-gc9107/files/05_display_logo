#!/bin/sh

show_logo() {
	(
		local BACKLIGHT="/sys/class/backlight/backlight"
		local i=0
		
		while [ ! -c /dev/fb0 ] && [ $i -lt 100 ]; do
			usleep 100000  # 100ms = 0.1s
			i=$((i + 1))
		done
		
		if [ -c /dev/fb0 ] && [ -f /etc/boot_logo.fb ]; then
			cat /etc/boot_logo.fb > /dev/fb0 2>/dev/null
		fi
		
		i=0
		while [ ! -d "$BACKLIGHT" ] && [ $i -lt 50 ]; do
			usleep 100000  # 100ms = 0.1s
			i=$((i + 1))
		done
		
		if [ -d "$BACKLIGHT" ]; then
			echo 0 > $BACKLIGHT/bl_power 2>/dev/null
			echo 1 > $BACKLIGHT/brightness 2>/dev/null
		fi
	) &
}

boot_hook_add preinit_main show_logo
